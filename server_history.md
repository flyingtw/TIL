# 서버 기술

 아직까지도 물리적인 서버를 사용하는 기업도 있으며 최신 쿠버네티스 기술을 사용하는 곳도 존재한다. 오늘은 최신 서버 기술의 발전사를 알아보며 각각의 장단점과 특징을 정리해본다.



## 서버 관리 기술의 발전

  기술의 발전에 따라 변화된 서버 기술들이다.

```c++
자체 서버 운영 

-> 설정 관리 도구 

-> 가상머신  

-> 클라우드 

-> PaaS 

->도커  

-> 쿠버네티스  

-> 서비스 메시
```

위의 순서로 서버 관리 시스템이 발전되어 왔다. 

서버의 상태를 안정적으로 관리하기 위한 기술들이다. 

------



### 자체 서버 운영

 보통 생각하는 전산실에서 사용되는 기초적인 서버 컴퓨터를 뜻한다. 물리적인 서버 컴퓨터를 구매하여 서버 프로그램을 상시 가동하여 놓는다. 한번 구입한 서버 컴퓨터는 업그레이드나 변경이 쉽지 않기 때문에 좋은 사양의 서버를 미리 구매하여 놓는다.

- 서버를 설정하기 위한 시간과 노력이 비효율적이다.
- 미리 성능이 좋은 물리적인 서버를 구매하여 여러 어플리케이션을 설치한다.

![image-20200715132228599](C:\Users\FlyingTW\AppData\Roaming\Typora\typora-user-images\image-20200715132228599.png)

- 권한 설정, 환경 설정, 방화벽 설정 등 기초 설정이 번거로우며 명령어를 통한 설정이 불가피 하다.
- 정적으로 미리 설치되어 있는 구조이기 때문에 똑같은 서버를 복제하기가 쉽지 않으며 변화를 주기가 쉽지 않다.



### 설정 관리 도구 (Configuration Management)

 기존에 mv, cp 와 같이 항상 명령어로 서버를 관리해야 하는 불편함을 해소하고자 서버 설정 내역이 담긴 코드를 사용하여 서버를 관리한다.

- 상태를 관리하는 코드(또는 설정 환경)을 이용하여 서버를 관리한다.
- 선언적인 상태의 서버를 정의해 놓는다.
- 설정 파일을 통해 서버 상태의 복제같은 재현이 가능해진다.
- 기존엔 **command** 를 통해 서버 설정을 하였다면 **code** 를 통해 서버를 설정한다.



### 가상 머신 (Virtual machine)

 vmware 같은 프로그램을 통해 OS 위에 가상 OS 를 설치하여 각각의 독립적인 서버 컴퓨터를 가상으로 구현하는 기술이다. 각각의 가상 머신은 자원은 공유하지만 독립적인 운영체제를 가지고 있어 언어의 버전, DB의 종류들을 독립적으로 사용할 수 있다.

- 하나의 서버에 여러개의 가상 서버를 설치할 수 있다.
- 다양한 버전의 Java 와 같은 독립적인 운영이 가능해졌다.
- 서버의 상태를 이미지로 저장할 수 있다.
- 새로운 서버를 만들어도 기존 서버 내용을 복사할 수 있다.



##### Immutable? Mutable?

> mutable : 서버의 설치된 애플리케이션을 새로운 버전으로 업데이트 하는것
>
> Immutable : 새로운 버전이 설치된 서버의 상태를 이미지로 만들고 교체하는것
>
> 즉, 가상머신을 사용하면 기존 상태를 고려할 필요 없이 통째로 서버를 교체 할 수 있다.





### 클라우드 (Cloud)

 AWS, Google Cloud, Azure, NBP 와 같이 가상화된 서버 환경을 사용하는 것이다.

- 하드웨어 파편화 문제를 해결한다.
- 각각의 서버 단계를 이미지로 백업하여 서버를 관리 할 수 있다.
- 서버가 어떻게 만들어졌는지 알 수 없으며 관리가 쉽지 않다.



### PaaS (Platform as a Service)

 Heroku, Netlify, AWS Elastic Beanstalk 와 같이 서버를 운영하는 것은 복잡하고 어렵기 때문에 미리 구축이 된 서비스를 이용하는 것이다. 하지만 PaaS 방식에 의존도가 높아 언어 버전등에 대한 제약이 많다.

- 기초적인 서버가 이미 구축된 환경에 애플리케이션을 소스코드만으로 배포가 가능한 방법이다. 
- 일반화된 프로비저닝 방법을 제공한다. (npm 과 같이 정해진 규칙을 따라 서버를 배포한다.)



###  도커 (Docker)

  컨테이너 라는 단위에 각각의 기능을 구현하는 서비스를 올려 서버를 구성한다. VM의 성능저하, 클라우드의 복잡성을 해결하고자 나왔으며 독립된 컨테이너를 통해 안정성도 높다.

- 컨테이너(격리된 환경에서 작동하는 프로세스)단위에 서버를 올려 독립된 서버 운영이 가능하다.
- 리눅스 커널의 인터페이스를 쉽게 사용 할 수 있다.
- 가상화 기술보다 훨씬 가볍게 동작한다.
- 이미지 단위로 프로세스 실행 환경을 구성해 준다.

![image-20200715135456572](C:\Users\FlyingTW\AppData\Roaming\Typora\typora-user-images\image-20200715135456572.png)

- 도커가 설치되어 있다면 어디서든 컨테이너를 실행할 수 있다.

- 개발서버, 테스트 서버 생성이 간편하다.

- docker run 이라는 간단한 명령어를 통해 nodejs, go, php 등 각각 다른 배포 방식을 하나로 통합하여 배포할 수 있다.

- Dockerfile을 이용하여 이미지를 만들고 처음부터 재현이 가능하다.

- 빌드 서버 이미지 생성 -> 이미지 저장소에 저장 -> 운영 서버에서 이미지 불러옴 의 순으로 간단하게 이미지 관리가 가능하다.

- 설정은 환경변수로 제어한다. (MYSQL_PASS = pw) 와 같이 컨테이너를 띄울때 환경변수를 같이 지정하여 하나의 이미지가 환경 변수에 따라 동적으로 설정 파일을 생성하도록 만든다.

- PaaS 와 같은 제한이 없으며 클라우드보단 관리하기가 쉽다.

- 다른 프로세스와 격리되어 가상머신처럼 사용하지만 성능의 저하가 없다.

- 오픈소스이다.

  ![image-20200715140121081](C:\Users\FlyingTW\AppData\Roaming\Typora\typora-user-images\image-20200715140121081.png)

- 원래 같았으면 모든 코드를 연결해 주어야 하지만 컨테이너를 이용하여 어디서든 여러가지 서비스를 사용할 수 있다.
- 하지만 하나의 컨테이너가 사용 불가능 할 경우 NGINX등을 사용하여 컨테이너를 재시작하여야 한다.



------

## 컨테이너 오케스트레이션

 도커는 하나의 서버에 여러 개의 서비스를 관리하기엔 편했지만 여러 대의 서버와 여러 개의 서비스를 사용하기엔 쉽지 않았다. 불편함을 해소하고자 도커의 서드파티의 개념으로 도커의 단점을 해소하고자 한 컨테이너 오케스트레이션 기술들이 등장하였다. 대표적으로 아래와 같은 기능들을 사용할 수 있다.



### 스케줄링 

-  컨테이너를 적당한 서버에 배포해 주는 작업
-  여러 대의 서버의 사용량에 따라 배포 순서를 정해준다.
-  서버가 죽으면 실행 중이던 컨테이너를 다른 서버에 띄워준다.



### 클러스터링

-  여러 개의 서버를 하나의 서버처럼 사용한다. 
-  가상 네트워크를 이용하여 마치 같은 서버에 있는것처럼 다수의 서버를 컨트롤 할 수 있다.



### 서비스 디스커버리

-  서비스가 어디에서 실행되고 있는지 찾아주는 기능이다. 
-  클러스터 환경에선 컨테이너가 어느 서버에 생성될지 알 수 없고 다른 서버로 이동할 경우도 발생하는데 항상 변하게 되는 IP나 Port 같은 정보를 자동으로 찾아준다.

------





## 쿠버네티스(kubernetes, k8s)

 구글에서 개발한 컨테이너 배포, 확장, 운영 도구이다. 도커를 이용한 다수의 서버, 다수의 서비스를 보다 쉽게 관리하기 위해서 개발되었다. 현재 컨테이너 오케스트레이션의 표준으로 자리잡고 있다.



